


# 大众点评爬虫Web应用 - 完整操作文档

！！！！！！！！！！！
使用技巧再爬取数据之前先尽可能地随便逛逛比如说美食以外地类别（装的像个人），然后再开始爬取数据，早上爬取完后，下午同理，爬取之前先随便逛逛，一般第一次爬取完后，就会出现验证码，手动解决即可，手动解决后再爬取过程中就没事了。   

## 📋 目录
1. [环境安装](#1-环境安装)
2. [Cookie获取](#2-cookie获取)
3. [高德API配置](#3-高德api配置)
4. [数据补充说明](#4-数据补充说明)
5. [使用流程](#5-使用流程)
6. [常见问题](#6-常见问题)

---

## 1. 环境安装

### 1.1 系统要求
- **操作系统**: Windows 10/11
- **Python版本**: Python 3.8 或更高版本
- **内存**: 至少 4GB RAM
- **磁盘空间**: 至少 2GB 可用空间


### 1.2 手动安装（推荐方式）

由于项目已删除自动安装脚本，请按照以下步骤手动安装：

**第一步：检查Python环境**
```bash
python --version
# 应该显示 Python 3.8.x 或更高版本
```

**第二步：安装依赖包**
```bash
cd /d "项目目录路径"
pip install -r requirements.txt
```

**第三步：安装Playwright浏览器**
```bash
playwright install chromium
```

**第四步：创建必要目录**
```bash
mkdir data\logs
mkdir data\outputs
mkdir data\temp
mkdir data\cookies
```

### 1.3 启动应用

手动启动应用：

**启动Flask应用：**
```bash
cd /d "项目目录路径"
python backend/app.py
```

如果看到以下信息，说明启动成功：
```
* Running on http://127.0.0.1:5000
* Running on http://0.0.0.0:5000
```

---

## 2. Cookie获取

### 2.1 什么是Cookie？
Cookie是网站用来识别用户身份的小文件，大众点评通过Cookie来验证用户登录状态。

### 2.2 获取Cookie的步骤

**方法一：使用Chrome浏览器（推荐）**

1. **打开大众点评网站**
   - 访问：https://www.dianping.com
   - 登录你的大众点评账号

2. **打开开发者工具**
   - 按 `F12` 键，或右键点击页面选择"检查"
   - 点击顶部的 `Network`（网络）标签

3. **刷新页面**
   - 按 `F5` 刷新页面
   - 在网络请求列表中找到第一个请求（通常是主页面）

4. **复制Cookie**
   - 点击该请求
   - 在右侧面板找到 `Request Headers`（请求头）
   - 找到 `Cookie:` 行
   - 复制整个Cookie字符串

**方法二：使用浏览器插件**

1. 安装Cookie导出插件（如：Cookie Editor）
2. 登录大众点评
3. 使用插件导出Cookie
4. 复制Cookie字符串

### 2.3 Cookie格式示例

正确的Cookie格式应该类似于：
```
_lxsdk_cuid=18a1234567890-0123456789abcdef-12345678-100200-18a1234567890; dper=c9abc123def456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890; ll=7fd06e09df4fbd44df25ac1ba6e02c5b; _lxsdk=18a1234567890-0123456789abcdef-12345678-100200-18a1234567890
```

### 2.4 Cookie使用注意事项

⚠️ **重要提醒：**
- 一个Cookie（账号）一天最多爬取2次
- 每次爬取间隔至少2小时（建议上午爬一次下午爬一次即可）
- 一次最多选择2个品类
- Cookie有效期通常为7-30天
- 不要分享你的Cookie给他人
- 目前一页有15个商铺数据，每次预计爬取2个品类的话，每次爬取15页，大概就是450个商铺数据（建议按照这强度来爬取）
- 如果有条件最好换俩个账号，今天用这个号，明天用另一个号交换着来


---

## 3. 高德API配置

### 3.1 什么是高德API？
高德API用于获取商家的详细地址信息，包括经纬度坐标、详细地址等。

### 3.2 获取高德API Key

**步骤1：注册高德开发者账号**
1. 访问：https://lbs.amap.com/
2. 点击"注册"创建账号
3. 完成邮箱验证

**步骤2：创建应用**
1. 登录后进入右上角点击"控制台"
2. 点击"创建新应用"
3. 填写应用信息：
   - 应用名称：`大众点评数据补充`
   - 应用类型：`Web服务`

**步骤3：添加Key**
1. 在应用中点击"添加Key"
2. 填写Key信息：
   - Key名称：`数据补充Key`
   - 服务平台：选择"Web服务"
   - IP白名单：留空或填写你的IP

**步骤4：获取Key**
- 创建成功后，复制生成的API Key
- 格式类似：`a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`

### 3.3 配置API Key

**方法一：在Web界面配置**
1. 启动应用后访问：http://localhost:5000
2. 在"高德API配置"区域输入API Key
3. 点击"保存配置"


### 3.4 API使用限制

- **免费额度**：每个月5000
- **QPS限制**：每秒最多100次调用
- **超出限制**：需要付费或等待次日重置

---

## 4. 数据补充说明

### 4.1 当前数据状态

**已导入的城市（10个）：**
- 长沙、深圳、苏州、南宁、上海
- 广州、杭州、厦门、武汉、西安

**已导入的品类数据：**
- 🍱 **日式料理** - 前15页基础数据已导入
- 🍰 **面包蛋糕甜品** - 前15页基础数据已导入
- ☕ **咖啡** - 前15页基础数据已导入
- 🥤 **饮品** - 前15页基础数据已导入
- 🥩 **烤肉** - 前15页基础数据已导入

### 4.2 可继续爬取的内容

**1. 更多页数**
- 每个品类可以爬取最多30页
- 当前只爬取了前15页，还可以爬取16-30页

**2. 其他品类**
```
可选品类包括：
- 小吃快餐、粤菜、自助餐、火锅、西餐
- 小龙虾、鱼鲜海鲜、烧烤烤串、韩式料理
- 川菜、粥粉面、水果生鲜、面馆、地方菜系
- 湘菜、特色菜、食品滋补、螺蛳粉、私房菜
- 茶餐厅、东北菜、农家菜、北京菜、早茶
- 家常菜、东南亚菜、新疆菜、江浙菜、素食
- 创意菜、中东菜、非洲菜、其他美食
```

**3. 其他城市**
- 可以添加更多城市进行爬取
- 需要在配置文件中添加城市代码

### 4.3 数据存储位置

- **原始数据**：`data/outputs/` 目录
- **数据库文件**：`data/database.db`
- **日志文件**：`data/logs/app.log`
- **临时文件**：`data/temp/`

### 4.4 数据格式说明

**Excel文件包含字段：**
- 商家名称、评分、评论数、人均消费
- 地址、电话、营业时间
- 品类、城市、页码等信息

**高德API补充字段：**
- 详细地址、经纬度坐标
- 行政区划信息

---

## 5. 使用流程

### 5.1 首次使用

1. **环境安装**
   按照第1章手动安装步骤完成环境配置

2. **启动应用**
   ```bash
   cd /d "项目目录路径"
   python backend/app.py
   ```

3. **访问界面**
   - 打开浏览器访问：http://localhost:5000

4. **配置Cookie**
   - 按照第2章获取Cookie
   - 在界面中输入并验证Cookie

5. **配置高德API**
   - 按照第3章获取API Key
   - 在界面中配置API Key

### 5.2 日常使用

1. **启动应用**
   ```bash
   cd /d "项目目录路径"
   python backend/app.py
   ```

2. **选择参数**
   - 选择城市
   - 选择品类（最多2个）
   - 设置页数范围

3. **开始爬取**
   - 点击"开始爬取"按钮
   - 等待爬取完成

4. **下载数据**
   - 在"数据管理"区域下载Excel文件

5. **数据补充**
   - 上传Excel文件到"高德API"区域
   - 点击"开始补充"获取详细地址信息

### 5.3 停止应用

**手动停止方法：**
- 在终端窗口按 `Ctrl+C` 组合键
- 或者在任务管理器中结束Python进程

---

## 6. 常见问题



### 6.1 安装问题

**Q: Python版本过低怎么办？**
A: 访问 https://python.org 下载最新版本的Python 3.8+

**Q: pip安装依赖失败？**
A: 尝试使用国内镜像：
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**Q: Playwright安装失败？**
A: 手动安装：
```bash
playwright install chromium --with-deps
```

### 6.2 Cookie问题

**Q: Cookie验证失败？**
A: 
- 确保已登录大众点评
- 重新获取Cookie
- 检查Cookie格式是否完整

**Q: Cookie过期怎么办？**
A: 重新登录大众点评并获取新的Cookie

### 6.3 爬取问题

**Q: 遇到验证码怎么办？**
A: 

- 手动解决后会继续自动爬取数据，本次爬取完后就停止，下午再说，经常会出现地
- 基本就上午爬差不多500条，下午爬500条，边界一般是1200，不超过就不会被封，403就是被封了

**Q: 爬取速度很慢？**
A: 这是正常现象，为了避免被封号，系统会自动控制爬取速度

### 6.4 高德API问题

**Q: API调用失败？**
A: 

- 检查API Key是否正确
- 确认API额度是否用完
- 检查网络连接

**Q: 免费额度用完了？**
A: 
- 等待次日重置

### 6.5 其他问题

**Q: 应用无法启动？**
A: 
- 检查端口5000是否被占用
- 查看日志文件：`data/logs/app.log`
- 重启计算机后再试

**Q: 数据丢失了？**
A: 
- 检查 `data/outputs/` 目录
- 查看数据库文件：`data/database.db`
- 查看备份文件

